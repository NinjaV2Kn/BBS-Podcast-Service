// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String    // Argon2 hash
  name      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  podcasts  Podcast[]
}

model Podcast {
  id          String    @id @default(uuid())
  title       String
  description String?
  slug        String    @unique  // For RSS feed URL
  coverUrl    String?
  categoryId  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  category    Category? @relation(fields: [categoryId], references: [id])
  
  episodes    Episode[]
}

model Episode {
  id          String    @id @default(uuid())
  title       String
  description String?
  audioUrl    String    // S3 URL or local file path
  duration    Int?      // in seconds
  publishedAt DateTime  @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  podcastId   String
  podcast     Podcast   @relation(fields: [podcastId], references: [id])
  
  plays       Play[]
}

model Play {
  id          String    @id @default(uuid())
  identifier  String    // SHA-256 hash of IP + User-Agent
  referer     String?   // To filter website vs. external plays
  createdAt   DateTime  @default(now())
  
  episodeId   String
  episode     Episode   @relation(fields: [episodeId], references: [id])
  
  @@index([episodeId])
  @@index([createdAt])
}

model Category {
  id        String    @id @default(uuid())
  name      String    @unique
  color     String    @default("#3b82f6")  // Tailwind blue-600
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  podcasts  Podcast[]
}
