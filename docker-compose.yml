version: '3.8'

# ============================================
# MINIMAL SETUP - Basic Podcast Platform
# ============================================
# Start with: docker-compose up -d
# Uses SQLite + local storage by default
#
# For Production with external services:
# See DOCKER.md for PostgreSQL + MinIO setup
# ============================================

services:
  # Backend API (required)
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: podcast-backend
    ports:
      - "8080:8080"
    environment:
      NODE_ENV: production
      JWT_SECRET: ${JWT_SECRET:-change-me-for-production}
      JWT_EXPIRY: 7d
      FRONTEND_URL: http://localhost:3000
      # Optional: PostgreSQL
      # DATABASE_URL: postgresql://user:password@postgres:5432/podcasts
      # Optional: S3/MinIO
      # S3_ENDPOINT: http://minio:9000
      # S3_ACCESS_KEY: minioadmin
      # S3_SECRET_KEY: change-me-for-production
    volumes:
      - ./backend/uploads:/app/uploads  # Local file storage
    networks:
      - podcast-network

  # Frontend Web App (required)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: podcast-frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - podcast-network
    environment:
      VITE_API_URL: http://localhost:8080

  # ============================================
  # OPTIONAL SERVICES (uncomment to enable)
  # ============================================

  # PostgreSQL Database (optional)
  # Uncomment to use PostgreSQL instead of SQLite
  # Then set DATABASE_URL in backend service above
  #
  # postgres:
  #   image: postgres:16-alpine
  #   container_name: podcast-db
  #   environment:
  #     POSTGRES_USER: podcast_user
  #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-change-me-for-production}
  #     POSTGRES_DB: podcasts
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U podcast_user"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #   networks:
  #     - podcast-network

  # MinIO S3 Storage (optional)
  # Uncomment to use S3 instead of local file storage
  # Then set S3_* variables in backend service above
  #
  # minio:
  #   image: minio/minio:latest
  #   container_name: podcast-minio
  #   environment:
  #     MINIO_ROOT_USER: minioadmin
  #     MINIO_ROOT_PASSWORD: ${MINIO_PASSWORD:-change-me-for-production}
  #   volumes:
  #     - minio_data:/minio_data
  #   ports:
  #     - "9000:9000"
  #     - "9001:9001"
  #   command: server /minio_data --console-address ":9001"
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
  #     interval: 30s
  #     timeout: 20s
  #     retries: 3
  #   networks:
  #     - podcast-network

# Volumes (only created if services are uncommented)
volumes:
  postgres_data:
  minio_data:

# Network
networks:
  podcast-network:
    driver: bridge

